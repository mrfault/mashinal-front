<template>
    <!-- <button
      class="btn-sq btn-sq--color-red"
      :class="{'active': isActive}"
      @click.prevent.stop="handleClick"
    >
      <icon name="compare" />
    </button> -->
<!--    <div class="white-background">-->
        <button
            class="btn-compare btn-transparent"
            :class="{ 'btn-compare-active': isActive }"
            @click.prevent.stop="handleClick()"
        >
            <span v-if="text">{{ text }}</span>

            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2.17112 15.8223C2.17112 14.8387 2.18301 13.8552 2.17112 12.8727C2.14376 12.519 2.18698 12.1634 2.29831 11.8266C2.40965 11.4898 2.58685 11.1785 2.81961 10.9109C3.09415 10.6147 3.00771 10.4656 2.67481 10.3197C2.35408 10.1712 2.04192 10.0048 1.73984 9.82138C1.18427 9.49712 1.09133 9.05072 1.3075 8.16225C1.45125 7.56669 1.71821 7.23271 2.40024 7.28459C3.10388 7.33755 3.81619 7.27378 4.52307 7.30512C4.91975 7.3235 5.14241 7.21217 5.24509 6.81333C5.35434 6.43615 5.48313 6.06492 5.63095 5.70113C5.75473 5.31301 5.99804 4.97397 6.32612 4.73247C6.65419 4.49097 7.05024 4.35939 7.45761 4.35653C8.10613 4.32195 8.75463 4.34464 9.40315 4.34896C9.72741 4.34896 10.0084 4.45057 10.0128 4.83428C10.0128 5.25473 9.7166 5.34553 9.37073 5.34769C8.78058 5.34769 8.19043 5.35742 7.60136 5.34769C7.36388 5.32546 7.12622 5.38821 6.93067 5.52478C6.73512 5.66134 6.59436 5.86286 6.53346 6.09348C6.37458 6.55717 6.18976 7.01329 6.04168 7.48023C5.9799 7.73139 5.83009 7.95208 5.61947 8.10221C5.40885 8.25235 5.15137 8.32197 4.8938 8.29844C4.18619 8.29844 3.47823 8.29844 2.7699 8.29844C2.54076 8.29844 2.29757 8.24872 2.21542 8.58487C2.13327 8.92102 2.34189 9.03342 2.57968 9.15448C2.89529 9.31445 3.20984 9.47874 3.51356 9.65816C3.65632 9.71821 3.78199 9.81264 3.87943 9.93302C3.97687 10.0534 4.04307 10.196 4.07206 10.3481C4.10106 10.5003 4.09198 10.6572 4.04564 10.805C3.99931 10.9528 3.91714 11.0868 3.80647 11.1951C3.57138 11.4584 3.39179 11.7665 3.2785 12.1007C3.16522 12.435 3.12054 12.7887 3.14712 13.1407C3.1709 14.9501 3.16658 16.7594 3.14712 18.5677C3.14712 18.9655 3.22927 19.1665 3.65945 19.0984C3.75766 19.0907 3.85633 19.0907 3.95454 19.0984C5.02459 19.0984 5.02244 19.0984 5.14349 18.0478C5.14384 17.9285 5.16821 17.8104 5.2152 17.7006C5.2622 17.5909 5.33082 17.4918 5.41698 17.4092C5.50313 17.3265 5.60504 17.2621 5.71665 17.2198C5.82825 17.1774 5.94727 17.158 6.06656 17.1626C7.20686 17.1399 8.34715 17.1518 9.48746 17.155C9.81172 17.155 10.0279 17.2966 10.0171 17.6447C10.0063 17.9927 9.78255 18.1213 9.46586 18.1235C8.52226 18.1235 7.57759 18.144 6.634 18.117C6.23949 18.1062 6.09357 18.1916 6.09357 18.6239C6.10222 20.1004 6.08385 20.1015 4.62684 20.1015C4.09614 20.1015 3.56436 20.1101 3.03365 20.1015C2.3927 20.0885 2.18623 19.8853 2.18191 19.2487C2.16569 18.104 2.17112 16.9637 2.17112 15.8223Z" fill="#364152" stroke="#364152" stroke-width="0.6"/>
                <path d="M21.819 15.9023C21.819 17.0037 21.819 18.1051 21.819 19.2054C21.819 19.882 21.6158 20.0863 20.9446 20.096C20.2175 20.1061 19.4901 20.1061 18.7623 20.096C18.1203 20.0863 17.9127 19.8723 17.8976 19.2508C17.8706 18.1234 17.8706 18.1234 16.7616 18.1234C16.0537 18.1234 15.3457 18.1234 14.6377 18.1234C14.2853 18.1234 13.9892 18.0402 13.9892 17.6219C13.9892 17.2036 14.3135 17.1463 14.6539 17.1474C15.657 17.1474 16.66 17.1474 17.662 17.1474C18.5472 17.1474 18.8985 17.4717 18.8509 18.358C18.8217 18.9514 18.9828 19.133 19.5913 19.1092C20.8408 19.0595 20.8419 19.0951 20.8419 17.8381C20.8419 16.206 20.8322 14.5739 20.8419 12.9418C20.8687 12.3284 20.6551 11.7289 20.2463 11.2708C20.116 11.1611 20.017 11.019 19.9594 10.8588C19.9017 10.6985 19.8874 10.5259 19.9179 10.3584C19.9484 10.1908 20.0226 10.0343 20.133 9.90472C20.2435 9.77511 20.3862 9.67698 20.5468 9.62029C20.8873 9.42465 21.231 9.23225 21.5834 9.0604C21.8179 8.94582 21.8092 8.77289 21.7671 8.56753C21.7249 8.36217 21.5801 8.29514 21.3801 8.29623C20.6527 8.29623 19.9253 8.29623 19.1979 8.29623C18.911 8.3472 18.6156 8.28229 18.3765 8.11573C18.1374 7.94917 17.9741 7.69455 17.9225 7.40775C17.7679 6.98405 17.6155 6.5582 17.4739 6.13018C17.4157 5.88863 17.2722 5.67623 17.0698 5.53206C16.8675 5.38788 16.6198 5.32162 16.3725 5.34547C15.7824 5.35844 15.1922 5.35088 14.6031 5.34547C14.2789 5.34547 13.9946 5.26008 13.9795 4.87421C13.9622 4.45268 14.2562 4.35 14.6053 4.34783C15.2343 4.34783 15.8645 4.32405 16.4925 4.34783C16.9095 4.34744 17.3158 4.47927 17.6532 4.72436C17.9905 4.96945 18.2415 5.31518 18.3699 5.71188C18.5666 6.22204 18.5742 6.91596 18.9936 7.19806C19.4335 7.4953 20.1004 7.26508 20.6668 7.28778C20.9608 7.29967 21.2569 7.28778 21.552 7.28778C22.3734 7.28778 22.4826 7.37966 22.701 8.22922C22.9193 9.07877 22.7896 9.50788 22.1789 9.85051C21.8935 10.0238 21.5983 10.1804 21.2948 10.3196C20.9197 10.4763 20.9392 10.6536 21.1867 10.9195C21.6501 11.4654 21.8779 12.1729 21.8201 12.8866C21.8082 13.8972 21.819 14.9003 21.819 15.9023Z" fill="#364152" stroke="#364152" stroke-width="0.6"/>
                <path d="M11.5119 11.6793C11.5119 8.88999 11.5119 6.10064 11.5119 3.3113C11.5072 3.15415 11.5104 2.99687 11.5216 2.84005C11.5301 2.72217 11.5824 2.61173 11.6681 2.53035C11.7539 2.44898 11.8669 2.40253 11.985 2.40009C12.1032 2.39766 12.218 2.43942 12.307 2.51719C12.396 2.59497 12.4528 2.70316 12.4663 2.82059C12.4807 2.97688 12.4847 3.13395 12.4781 3.29076C12.4781 8.91125 12.4781 14.5292 12.4781 20.1447C12.4781 20.243 12.4781 20.3414 12.4781 20.4397C12.4911 20.778 12.37 21.045 12.0036 21.0515C11.6372 21.058 11.5043 20.8018 11.5108 20.4592C11.5108 20.2236 11.5108 19.9879 11.5108 19.7523L11.5119 11.6793Z" fill="#364152" stroke="#364152" stroke-width="0.6"/>
                <path d="M6.71495 14.4453C6.38205 14.4453 6.047 14.4648 5.71626 14.4399C5.56691 14.4408 5.42282 14.3847 5.31337 14.2831C5.20393 14.1815 5.13735 14.042 5.12717 13.893C5.04395 13.3202 5.14878 13.2034 5.72704 13.2672C6.25234 13.3245 6.77873 13.3817 7.30295 13.4477C7.58505 13.4833 7.85851 13.5633 7.93201 13.8854C8.01524 14.2497 8.01307 14.5642 7.47912 14.5004C7.22498 14.4855 6.97018 14.4855 6.71604 14.5004L6.71495 14.4453Z" fill="#364152" stroke="#364152" stroke-width="0.6"/>
                <path d="M17.1745 14.4972C17.0383 14.4972 16.8211 14.5123 16.6071 14.4972C16.3931 14.4821 16.0558 14.6593 16.0299 14.2248C16.0094 13.8822 16.0861 13.5763 16.4763 13.5082C17.1724 13.4001 17.8728 13.318 18.5732 13.2326C18.8185 13.2034 18.8596 13.372 18.8682 13.5677C18.8855 13.9395 18.8617 14.3242 18.424 14.4129C18.0099 14.4695 17.5924 14.4976 17.1745 14.4972Z" fill="#364152" stroke="#364152" stroke-width="0.6"/>
            </svg>

            <!--            <i></i>-->
        </button>
<!--    </div>-->
</template>

<script>
import {mapGetters} from 'vuex';

export default {
    props: {
        text: {
            type: String
        },
        img: {
            type: Boolean,
            default: false
        },
        id: {
            type: [Number, String],
            required: false
        },
        type: {
            type: String,
            required: false,
            default: 'announcement',
            validator(val) {
                return ['announcement', 'model'].includes(val)
            }

        }
    },
    methods: {
        async handleClick() {
            if (this.type === 'announcement') {
                if (this.announcementsList.findIndex(a => a.id_unique === this.id) >= 0) {
                    this.$toasted.success(this.$t('comparison_removed'))
                } else {
                    if (this.limit === this.announcementsList.length) {
                        this.$toasted.error(this.$t('reached_the_limit_announcement'))
                    } else {
                        this.$toasted.success(this.$t('comparison_added'))
                    }
                }
                await this.$store.dispatch('comparison/toggleAnnouncement', this.id)
            } else {
                if (this.modelsList.findIndex(a => a.id === this.id) >= 0) {
                    this.$toasted.success(this.$t('comparison_removed'))
                } else {
                    if (this.limit === this.modelsList.length) {
                        this.$toasted.error(this.$t('reached_the_limit_model'))
                    } else {
                        this.$toasted.success(this.$t('comparison_added'))
                    }
                }
                await this.$store.dispatch('comparison/toggleModel', this.id)
            }
        }
    },
    computed: {
        ...mapGetters({
            announcementsList: 'comparison/announcementsList',
            announcementIds: 'comparison/announcementIds',
            modelsList: 'comparison/modelsList',
            limit: 'comparison/limit',
        }),
        isActive() {
            if (this.type === 'announcement') {
                return this.announcementIds.findIndex(aId => aId === this.id) >= 0
            } else {
                return this.modelsList.findIndex(model => model.id === this.id) >= 0
            }
        }
    }
}
</script>
