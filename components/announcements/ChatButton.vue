<template>
    <button :class="['chat-button btn full-width', `btn--${className} `]" @click.stop="handleClick">
<!--        <icon name="chat"/>-->
        {{ $t('write') }}

        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_864_2657)">
                <path d="M16.7243 2.9316C14.9002 1.07492 12.4572 0.0325733 9.86762 0H9.83505C9.81876 0 9.81876 0 9.80248 0C7.96209 0 6.15427 0.521173 4.60704 1.49837C3.04352 2.47557 1.78945 3.87622 0.975115 5.55375C0.177069 7.21498 -0.148664 9.07166 0.0630625 10.9121C0.258502 12.671 0.926255 14.316 1.9686 15.7329L0.714528 18.6645C0.665668 18.7785 0.633095 18.9088 0.633095 19.0228C0.633095 19.1531 0.649382 19.2671 0.698242 19.3974C0.747102 19.5114 0.812248 19.6254 0.893681 19.7068C0.975115 19.8046 1.08912 19.8697 1.20313 19.9186C1.33342 19.9674 1.44743 20 1.59401 20C1.64287 20 1.70801 20 1.75687 19.9837L6.64287 19.1205C7.65264 19.4788 8.69498 19.6417 9.75362 19.6417C9.7699 19.6417 9.78619 19.6417 9.78619 19.6417C12.3921 19.6254 14.835 18.5993 16.6592 16.7427C18.4995 14.9023 19.5093 12.443 19.5256 9.83713C19.5419 7.24756 18.5484 4.78827 16.7243 2.9316ZM3.97186 15.9446C4.037 15.7818 4.06958 15.6026 4.037 15.4235C4.00443 15.2443 3.93928 15.0814 3.80899 14.9349C3.23896 14.2671 2.78293 13.5179 2.4572 12.7036C2.03375 11.6287 1.85459 10.456 1.93603 9.29967C2.01746 8.14332 2.34319 7.00326 2.89694 5.99348C3.45068 4.98371 4.23244 4.08795 5.17707 3.4202C6.10541 2.73616 7.19661 2.26384 8.32039 2.05212C8.80899 1.9544 9.29759 1.90554 9.80248 1.90554C10.4539 1.90554 11.1217 1.98697 11.7569 2.14984C12.8644 2.443 13.923 2.98046 14.8188 3.69707C15.7145 4.42997 16.4474 5.37459 16.936 6.40065C17.4246 7.443 17.7015 8.59935 17.7015 9.78827C17.7015 11.9055 16.8709 13.8925 15.3888 15.3746C13.9067 16.8567 11.9197 17.6873 9.80248 17.7036C8.85785 17.7036 7.9458 17.5407 7.08261 17.1987C6.91974 17.1335 6.74059 17.1173 6.56143 17.1498L3.17381 17.7362L3.97186 15.9446Z" fill="#155EEF"/>
                <path d="M6.65915 8.63192H10.5227C10.7833 8.63192 11.0276 8.5342 11.2067 8.35505C11.3859 8.1759 11.4836 7.9316 11.4836 7.67101C11.4836 7.41042 11.3859 7.16612 11.2067 6.98697C11.0276 6.80782 10.7833 6.7101 10.5227 6.7101H6.65915C6.39857 6.7101 6.15427 6.80782 5.97512 6.98697C5.79596 7.16612 5.69824 7.41042 5.69824 7.67101C5.69824 7.9316 5.79596 8.1759 5.97512 8.35505C6.15427 8.5342 6.39857 8.63192 6.65915 8.63192Z" fill="#155EEF"/>
                <path d="M12.9783 11.987C13.2389 11.987 13.4832 11.8893 13.6623 11.7101C13.8415 11.5309 13.9392 11.2866 13.9392 11.0261C13.9392 10.7655 13.8415 10.5212 13.6623 10.342C13.4832 10.1629 13.2389 10.0651 12.9783 10.0651H6.6428C6.38221 10.0651 6.13791 10.1629 5.95876 10.342C5.7796 10.5212 5.68188 10.7655 5.68188 11.0261C5.68188 11.2866 5.7796 11.5309 5.95876 11.7101C6.13791 11.8893 6.38221 11.987 6.6428 11.987H12.9783Z" fill="#155EEF"/>
            </g>
            <defs>
                <clipPath id="clip0_864_2657">
                    <rect width="20" height="20" fill="white"/>
                </clipPath>
            </defs>
        </svg>
    </button>
</template>

<script>
    export default {
        props: {
            announcement: {},
            hasAfterLogin: Boolean,
            className: {
                default: ''
            }
        },
        methods: {
            handleClick() {
                if (!this.canSendMessage(this.announcement)) return;
                if (!this.loggedIn) {
                    this.$nuxt.$emit('login-popup', 'chat')
                } else {
                    this.createMessagesGroup(this.announcement.user.id, this.announcement.id_unique);
                }
            },
            handleAfterLogin(key) {
                if (key === 'chat') this.handleClick();
            }
        },
        mounted() {
            if (this.hasAfterLogin)
                this.$nuxt.$on('after-login', this.handleAfterLogin);
        },
        beforeDestroy() {
            if (this.hasAfterLogin)
                this.$nuxt.$off('after-login', this.handleAfterLogin);
        }
    }
</script>

<style lang="scss" scoped>
    .chat-button {
        height: 56px;
        background: #EFF4FF;
        border-radius: 6px;
        svg {
            margin-left: 10px;
        }
    }
</style>